<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IKRAAM CLOUD v68.0</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .amount-val { font-family: 'Courier New', monospace; font-weight: 900; }
        .hidden-module { display: none !important; }
        @media (max-width: 640px) {
            .nav-text { font-size: 10px; }
            .btn-text { font-size: 8px; padding: 4px 6px; }
            .card-grid { grid-template-cols: 1fr; }
        }
    </style>
</head>
<body class="text-slate-900">

    <div id="loginOverlay" class="fixed inset-0 bg-slate-900 z-[100] flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-[2rem] shadow-2xl w-full max-w-sm text-center border-t-4 border-indigo-600">
            <h2 class="font-black text-2xl mb-2 italic">IKRAAM LEDGER</h2>
            <p class="text-[10px] font-bold text-slate-400 mb-6 uppercase">Cloud Sync Security</p>
            <input type="password" id="loginPass" placeholder="Admin Password" class="w-full border-2 p-4 rounded-xl text-center font-bold mb-4 outline-none focus:border-indigo-600">
            <button onclick="checkLogin()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-black uppercase shadow-lg">Unlock App</button>
            <p id="errorMsg" class="text-rose-500 text-[10px] mt-2 hidden">Wrong Password!</p>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <nav class="bg-slate-900 text-white p-3 sticky top-0 z-50 flex justify-between items-center shadow-lg">
            <div class="flex items-center gap-2">
                <span id="syncStatus" class="w-2 h-2 bg-rose-500 rounded-full"></span>
                <h1 id="navHeader" class="font-black uppercase nav-text italic text-indigo-300">IKRAAM MASTER PRO</h1>
            </div>
            <div class="flex gap-1">
                <button onclick="openConfig()" class="bg-amber-600 px-2 py-1 rounded text-[9px] font-black btn-text uppercase">Config</button>
                <button onclick="window.print()" class="bg-rose-600 px-2 py-1 rounded text-[9px] font-black btn-text uppercase">Print</button>
                <button onclick="secureBackup()" class="bg-indigo-600 px-2 py-1 rounded text-[9px] font-black btn-text uppercase">Backup</button>
            </div>
        </nav>

        <div class="container mx-auto p-4 grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-4 no-print">
                <div class="bg-white p-6 rounded-[2rem] shadow-xl border border-slate-200">
                    <form id="ledgerForm" class="space-y-4">
                        <input type="date" id="tDate" required class="w-full border p-3 rounded-xl font-bold text-sm">
                        <input list="partyList" id="tParty" placeholder="Name (Person/Unit)" required class="w-full border p-3 rounded-xl font-bold text-sm">
                        <select id="tCat" onchange="toggleVisit(this.value)" required class="w-full border p-3 rounded-xl font-bold text-sm bg-gray-50"></select>
                        
                        <div id="visitBox" class="bg-indigo-50 p-4 rounded-xl hidden-module space-y-3">
                            <input type="text" id="vPurpose" placeholder="Visit Purpose" class="w-full border p-2 rounded-lg text-xs">
                            <input type="number" id="vMisc" placeholder="Misc/Reading Amount" class="w-full border p-2 rounded-lg text-xs">
                        </div>

                        <select id="tMode" class="w-full border p-3 rounded-xl font-bold text-sm bg-gray-50">
                            <option value="Cash">Cash</option>
                            <option value="EasyPaisa">EasyPaisa</option>
                            <option value="JazzCash">JazzCash</option>
                            <option value="Udhaar">Udhaar</option>
                        </select>
                        <textarea id="tDesc" placeholder="Details..." class="w-full border p-3 rounded-xl font-bold text-sm h-16"></textarea>
                        <input type="number" id="tAmount" placeholder="Amount" required class="w-full bg-slate-100 p-4 rounded-xl font-black text-2xl text-center outline-none">
                        <button type="submit" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-black uppercase shadow-lg">Save Entry</button>
                    </form>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-4">
                <div id="dash" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
                <div class="bg-white rounded-2xl shadow-xl overflow-hidden border">
                    <table class="w-full text-left text-xs">
                        <thead class="bg-slate-900 text-white font-black uppercase">
                            <tr><th class="p-3">Date</th><th class="p-3">Details</th><th class="p-3 text-right">Amount</th><th class="p-3 no-print">Action</th></tr>
                        </thead>
                        <tbody id="tBody" class="font-bold divide-y italic"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <datalist id="partyList"></datalist>

    <script>
        // 1. FIREBASE CONFIG (YAHAN APNA CODE PASTE KAREIN)
        const firebaseConfig = {
            apiKey: "AIzaSyDzSEb2I1VXKQtrRj6XwzCB4lwC7T4X1go",
  authDomain: "ikraamledger.firebaseapp.com",
  databaseURL: "https://ikraamledger-default-rtdb.firebaseio.com",
  projectId: "ikraamledger",
  storageBucket: "ikraamledger.firebasestorage.app",
  messagingSenderId: "992347779396",
  appId: "1:992347779396:web:8251534d4358587bf5a711"
        };

        firebase.initializeApp(firebaseConfig);
        const rdb = firebase.database();
        const CODES = ["INC-01", "EXP-01", "OFFICE-BILL", "INC-08", "INC-05", "EXP-03", "INC-04", "EXP-04"];
        let db = { 
            entries: [], parties: [], 
            labels: {"INC-01":"Shop Sale","EXP-01":"Personal","OFFICE-BILL":"Visit Out","INC-08":"Visit Back","INC-05":"Loan In","EXP-03":"Loan Out","INC-04":"Udhaar Rec","EXP-04":"Udhaar Diya"},
            visible: CODES.reduce((a,c)=>({...a,[c]:true}), {}),
            adminPass: "admin786" 
        };

        // SYNC DATA FROM CLOUD
        rdb.ref('ledger_data').on('value', (snapshot) => {
            if(snapshot.exists()) {
                db = snapshot.val();
                document.getElementById('syncStatus').classList.replace('bg-rose-500', 'bg-emerald-500');
                render();
            }
        });

        function checkLogin() {
            const p = document.getElementById('loginPass').value;
            if(p === db.adminPass) {
                document.getElementById('loginOverlay').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
            } else {
                document.getElementById('errorMsg').classList.remove('hidden');
            }
        }

        function toggleVisit(v) { document.getElementById('visitBox').classList.toggle('hidden-module', v !== 'OFFICE-BILL'); }

        function render() {
            const catS = document.getElementById('tCat'); catS.innerHTML = '';
            CODES.forEach(c => { if(db.visible[c]) catS.appendChild(new Option(db.labels[c], c)); });
            
            const tbody = document.getElementById('tBody'); tbody.innerHTML = '';
            let s = { cash: 0, off: 0, rec: 0, pay: 0 };

            db.entries.sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(t => {
                const amt = parseFloat(t.amount); const isInc = t.cat.startsWith('INC') || t.cat === 'INC-08';
                
                if(t.mode !== 'Udhaar') s.cash += (isInc ? amt : -amt);
                if(t.cat === 'OFFICE-BILL') s.off += amt; if(t.cat === 'INC-08') s.off -= amt;
                if(t.cat === 'EXP-04') s.rec += amt; if(t.cat === 'INC-04') s.rec -= amt;
                if(t.cat === 'INC-05') s.pay += amt; if(t.cat === 'EXP-03') s.pay -= amt;

                tbody.innerHTML += `<tr>
                    <td class="p-3 text-slate-400">${t.date}</td>
                    <td class="p-3"><b>${t.party}</b><br><span class="text-[9px] text-slate-500">${t.desc}</span></td>
                    <td class="p-3 text-right font-black ${isInc?'text-emerald-600':'text-rose-600'}">${amt.toLocaleString()}</td>
                    <td class="p-3 no-print"><button onclick="deleteEntry(${t.id})" class="text-rose-500">ðŸ—‘</button></td>
                </tr>`;
            });

            document.getElementById('dash').innerHTML = `
                <div class="bg-white p-3 rounded-xl border-b-4 border-slate-900 shadow"><p class="text-[8px] font-black uppercase">Cash/Online</p><h2 class="font-black text-lg">${s.cash.toLocaleString()}</h2></div>
                <div class="bg-white p-3 rounded-xl border-b-4 border-emerald-500 shadow"><p class="text-[8px] font-black uppercase">Receivables</p><h2 class="font-black text-lg text-emerald-600">${s.rec.toLocaleString()}</h2></div>
                <div class="bg-white p-3 rounded-xl border-b-4 border-amber-500 shadow"><p class="text-[8px] font-black uppercase">Visit Bal</p><h2 class="font-black text-lg text-amber-600">${s.off.toLocaleString()}</h2></div>
                <div class="bg-white p-3 rounded-xl border-b-4 border-rose-500 shadow"><p class="text-[8px] font-black uppercase">Loan Bal</p><h2 class="font-black text-lg text-rose-600">${s.pay.toLocaleString()}</h2></div>`;
        }

        document.getElementById('ledgerForm').onsubmit = (e) => {
            e.preventDefault();
            let amt = parseFloat(document.getElementById('tAmount').value);
            let desc = document.getElementById('tDesc').value;
            if(document.getElementById('tCat').value === 'OFFICE-BILL') {
                const m = parseFloat(document.getElementById('vMisc').value) || 0;
                amt += m; desc = `[V: ${document.getElementById('vPurpose').value} Misc: ${m}] ` + desc;
            }
            const entry = { id: Date.now(), date: document.getElementById('tDate').value, party: document.getElementById('tParty').value, cat: document.getElementById('tCat').value, mode: document.getElementById('tMode').value, desc: desc, amount: amt };
            db.entries.unshift(entry); save(); e.target.reset();
        };

        function save() { rdb.ref('ledger_data').set(db); }
        function deleteEntry(id) { if(confirm("Delete?")) { db.entries = db.entries.filter(x=>x.id!==id); save(); } }
        function secureBackup() { 
            const key = prompt("Backup Pass:"); if(!key) return;
            const enc = CryptoJS.AES.encrypt(JSON.stringify(db), key).toString();
            const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([enc])); a.download="Backup.txt"; a.click();
        }
    </script>
</body>
</html>