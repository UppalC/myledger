<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IKRAAM MASTER PRO v71.0</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f3f4f6; }
        .amount-val { font-family: 'Courier New', monospace; font-weight: 900; }
        .no-print { @media print { display: none; } }
    </style>
</head>
<body>

    <div id="authSection" class="min-h-screen flex items-center justify-center p-6 bg-slate-900">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl w-full max-w-sm border-t-8 border-indigo-600">
            <h2 class="font-black text-2xl text-center mb-1 italic">IKRAAM MASTER</h2>
            <p class="text-[10px] text-center font-bold text-slate-400 mb-6 uppercase tracking-widest">Multi-User Secure Cloud</p>
            
            <div class="space-y-4">
                <input type="email" id="userEmail" placeholder="Email Address" class="w-full border-2 p-4 rounded-2xl outline-none focus:border-indigo-600 font-bold">
                <input type="password" id="userPass" placeholder="Password" class="w-full border-2 p-4 rounded-2xl outline-none focus:border-indigo-600 font-bold">
                <button onclick="handleAuth('login')" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black uppercase shadow-xl hover:bg-indigo-700 active:scale-95 transition-all">Login</button>
                <div class="flex items-center gap-2 my-2">
                    <hr class="flex-1"> <span class="text-[10px] font-bold text-slate-400">YA</span> <hr class="flex-1">
                </div>
                <button onclick="handleAuth('signup')" class="w-full bg-emerald-50 text-emerald-600 py-3 rounded-2xl font-black uppercase text-xs border-2 border-emerald-100">Naya Account Banayein</button>
            </div>
            <p id="authMsg" class="text-rose-500 text-[10px] font-bold mt-4 text-center hidden uppercase italic"></p>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <nav class="bg-slate-900 text-white p-3 sticky top-0 z-50 flex justify-between items-center shadow-xl no-print">
            <div class="flex items-center gap-2">
                <div id="statusDot" class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                <h1 class="font-black uppercase text-[10px] md:text-sm italic text-indigo-300">IKRAAM LEDGER</h1>
            </div>
            <div class="flex gap-2">
                <button onclick="logout()" class="bg-rose-600 px-3 py-1 rounded-lg text-[9px] font-black uppercase">Logout</button>
            </div>
        </nav>

        <div class="container mx-auto p-2 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-4 no-print">
                <div class="bg-white p-6 rounded-[2.5rem] shadow-xl border-t-8 border-indigo-600">
                    <form id="ledgerForm" class="space-y-4">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="date" id="tDate" required class="w-full border p-3 rounded-xl font-bold text-xs">
                            <select id="tMode" class="w-full border p-3 rounded-xl font-bold text-xs bg-slate-50">
                                <option value="Cash">Cash</option><option value="Udhaar">Udhaar</option>
                                <option value="EasyPaisa">EasyPaisa</option><option value="JazzCash">JazzCash</option>
                                <option value="NayaPay">NayaPay</option><option value="SadaPay">SadaPay</option>
                            </select>
                        </div>
                        <input list="partyList" id="tParty" placeholder="Unit Name / Person Name" required class="w-full border p-3 rounded-xl font-bold text-sm">
                        <select id="tCat" required class="w-full border p-3 rounded-xl font-bold text-sm bg-slate-50"></select>
                        <textarea id="tDesc" placeholder="Entry ki tafseel..." class="w-full border p-3 rounded-xl font-bold text-sm h-16"></textarea>
                        <div class="bg-slate-900 p-4 rounded-2xl">
                            <label class="text-[9px] text-slate-500 font-black uppercase block text-center mb-1">Amount</label>
                            <input type="number" id="tAmount" placeholder="0.00" required class="w-full bg-transparent text-white font-black text-3xl text-center outline-none">
                        </div>
                        <button type="submit" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black uppercase shadow-lg hover:bg-indigo-700">Save Record</button>
                    </form>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-4">
                <div class="bg-white p-4 rounded-2xl shadow-md border-2 border-indigo-50 no-print flex items-center gap-3">
                    <span class="text-xl">üîç</span>
                    <input type="text" id="mSearch" oninput="render()" placeholder="Search: 'Khan', 'EasyPaisa', 'Feb'..." class="w-full outline-none font-bold text-sm uppercase">
                </div>

                <div id="dash" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>

                <div class="bg-white rounded-[2rem] shadow-xl overflow-hidden border-2 border-slate-100">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-[11px] md:text-sm">
                            <thead class="bg-slate-900 text-white font-black uppercase italic">
                                <tr><th class="p-4">Date</th><th class="p-4">Details</th><th class="p-4 text-right">Amount</th><th class="p-4 text-center no-print">Act</th></tr>
                            </thead>
                            <tbody id="tBody" class="font-bold divide-y divide-slate-100 italic"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <datalist id="partyList"></datalist>

    <script>
        // 1. FIREBASE CONFIG (YAHAN APNA CODE PASTE KAREIN)
        const firebaseConfig = {
            apiKey: "AIzaSyDzSEb2I1VXKQtrRj6XwzCB4lwC7T4X1go",
            authDomain: "ikraamledger.firebaseapp.com",
            databaseURL: "https://ikraamledger-default-rtdb.firebaseio.com",
            projectId: "ikraamledger",
            storageBucket: "ikraamledger.firebasestorage.app",
            messagingSenderId: "992347779396",
            appId: "1:992347779396:web:8251534d4358587bf5a711"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const rdb = firebase.database();
        let currentUser = null;
        let db = { 
            entries: [], 
            labels: {"INC-01":"Shop Sale","EXP-01":"Ghar Kharcha","OFFICE-BILL":"Visit Expense","INC-08":"Visit Recovery","INC-05":"Borrowing/Loan Taken","EXP-03":"Loan Given","INC-04":"Udhaar Wapsi","EXP-04":"Udhaar Diya"} 
        };

        // AUTH HANDLER
        function handleAuth(type) {
            const email = document.getElementById('userEmail').value;
            const pass = document.getElementById('userPass').value;
            const msg = document.getElementById('authMsg');
            msg.classList.add('hidden');

            if(type === 'signup') {
                auth.createUserWithEmailAndPassword(email, pass)
                .catch(err => { msg.innerText = err.message; msg.classList.remove('hidden'); });
            } else {
                auth.signInWithEmailAndPassword(email, pass)
                .catch(err => { msg.innerText = "Check Email/Password!"; msg.classList.remove('hidden'); });
            }
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                loadUserData();
            } else {
                document.getElementById('authSection').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
        });

        function logout() { auth.signOut(); }

        // DATA HANDLER
        function loadUserData() {
            rdb.ref('users/' + currentUser.uid).on('value', (snapshot) => {
                if(snapshot.exists()) {
                    db = snapshot.val();
                } else {
                    db.entries = [];
                    save();
                }
                render();
            });
        }

        function save() { if(currentUser) rdb.ref('users/' + currentUser.uid).set(db); }

        function render() {
            const catS = document.getElementById('tCat'); catS.innerHTML = '';
            Object.keys(db.labels).forEach(c => catS.appendChild(new Option(db.labels[c], c)));
            
            const tbody = document.getElementById('tBody'); tbody.innerHTML = '';
            const q = document.getElementById('mSearch').value.toLowerCase();
            let s = { cash: 0, rec: 0, off: 0, loan: 0 };

            (db.entries || []).forEach(t => {
                const searchStr = `${t.party} ${t.desc} ${t.mode} ${db.labels[t.cat]}`.toLowerCase();
                if(!q || searchStr.includes(q)) {
                    const isInc = t.cat.startsWith('INC');
                    const amt = parseFloat(t.amount);
                    
                    // Dashboard Logic
                    if(t.mode !== 'Udhaar') s.cash += (isInc ? amt : -amt);
                    if(t.cat === 'EXP-04') s.rec += amt; if(t.cat === 'INC-04') s.rec -= amt;
                    if(t.cat === 'OFFICE-BILL') s.off += amt; if(t.cat === 'INC-08') s.off -= amt;
                    if(t.cat === 'INC-05') s.loan += amt; if(t.cat === 'EXP-03') s.loan -= amt;

                    tbody.innerHTML += `<tr class="hover:bg-indigo-50 transition-all">
                        <td class="p-4 text-slate-400 font-normal">${t.date}</td>
                        <td class="p-4 uppercase">
                            <div class="font-black text-slate-800">${t.party}</div>
                            <div class="text-[9px] text-slate-500 font-normal">${t.mode} | ${db.labels[t.cat]}</div>
                        </td>
                        <td class="p-4 text-right font-black text-lg ${isInc?'text-emerald-600':'text-rose-600'} amount-val">${amt.toLocaleString()}</td>
                        <td class="p-4 text-center no-print"><button onclick="deleteEntry(${t.id})" class="bg-rose-50 text-rose-500 p-2 rounded-lg">üóë</button></td>
                    </tr>`;
                }
            });

            document.getElementById('dash').innerHTML = `
                <div class="bg-white p-4 rounded-2xl border-b-4 border-slate-900 shadow-lg text-center"><p class="text-[8px] font-black uppercase text-slate-400">Cash/Online</p><h2 class="font-black text-lg amount-val">${s.cash.toLocaleString()}</h2></div>
                <div class="bg-white p-4 rounded-2xl border-b-4 border-emerald-500 shadow-lg text-center"><p class="text-[8px] font-black uppercase text-emerald-500">Receivable</p><h2 class="font-black text-lg text-emerald-700 amount-val">${s.rec.toLocaleString()}</h2></div>
                <div class="bg-white p-4 rounded-2xl border-b-4 border-amber-500 shadow-lg text-center"><p class="text-[8px] font-black uppercase text-amber-500">Visit Bal</p><h2 class="font-black text-lg text-amber-700 amount-val">${s.off.toLocaleString()}</h2></div>
                <div class="bg-white p-4 rounded-2xl border-b-4 border-rose-500 shadow-lg text-center"><p class="text-[8px] font-black uppercase text-rose-500">Loan Taken</p><h2 class="font-black text-lg text-rose-700 amount-val">${s.loan.toLocaleString()}</h2></div>`;
        }

        document.getElementById('ledgerForm').onsubmit = (e) => {
            e.preventDefault();
            const entry = {
                id: Date.now(),
                date: document.getElementById('tDate').value,
                party: document.getElementById('tParty').value,
                cat: document.getElementById('tCat').value,
                mode: document.getElementById('tMode').value,
                desc: document.getElementById('tDesc').value,
                amount: parseFloat(document.getElementById('tAmount').value)
            };
            if(!db.entries) db.entries = [];
            db.entries.unshift(entry);
            save(); e.target.reset();
        };

        function deleteEntry(id) { if(confirm("Kya aap mitaana chahte hain?")) { db.entries = db.entries.filter(x=>x.id!==id); save(); } }
    </script>
</body>
</html>