<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Ledger Pro v90.0</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style id="themeStyles">
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        :root { --main-bg: #f8fafc; --primary: #4f46e5; --accent: #1e293b; }
        body { font-family: 'Inter', sans-serif; background: var(--main-bg); transition: 0.3s; }
        .amount-val { font-family: 'Courier New', monospace; font-weight: 900; }
        .hidden-module { display: none !important; }
        .input-focus:focus { border-color: var(--primary); box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1); outline: none; }
        @media print { .no-print { display: none !important; } }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-slate-900 overflow-x-hidden">

    <div id="loader" class="fixed inset-0 bg-white/90 z-[300] hidden flex flex-col items-center justify-center">
        <div class="spinner mb-2"></div>
        <p class="text-[9px] font-black uppercase tracking-widest text-indigo-600 italic">Syncing Cloud Database...</p>
    </div>

    <div id="authSection" class="min-h-screen flex items-center justify-center p-4 bg-slate-900">
        <div class="bg-white p-8 rounded-[3rem] shadow-2xl w-full max-w-sm border-t-8 border-indigo-600">
            <div class="text-4xl text-center mb-2">üè•</div>
            <h2 class="font-black text-2xl text-center mb-1 italic text-slate-800 tracking-tighter uppercase">Professional Ledger</h2>
            <p class="text-[9px] text-center font-bold text-slate-400 mb-8 uppercase tracking-[0.3em]">Multi-Business Solutions</p>
            
            <div class="space-y-4">
                <input type="email" id="userEmail" placeholder="Email Address" class="w-full border-2 p-4 rounded-2xl font-bold input-focus">
                <input type="password" id="userPass" placeholder="Password" class="w-full border-2 p-4 rounded-2xl font-bold input-focus">
                <button onclick="handleAuth('login')" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black uppercase shadow-xl hover:bg-indigo-700 transition-all">Login</button>
                <div class="flex justify-between px-2 pt-2">
                    <button onclick="handleAuth('reset')" class="text-[9px] font-black text-rose-500 uppercase">Reset Pass</button>
                    <button onclick="handleAuth('signup')" class="text-[9px] font-black text-emerald-600 uppercase">New Account</button>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-slate-100">
                <button onclick="showGuide()" class="w-full text-[10px] font-bold text-indigo-500 hover:underline uppercase italic text-center">üìñ Advance User Guide</button>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <nav class="bg-slate-900 text-white p-3 sticky top-0 z-50 flex justify-between items-center shadow-xl no-print">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                <h1 id="brandName" class="font-black uppercase text-[10px] italic text-indigo-300">My Ledger Pro</h1>
            </div>
            <div class="flex items-center gap-2 md:gap-3">
                <span class="text-[8px] font-black text-slate-500 uppercase hidden md:inline">Dev: Ikraam Uppal</span>
                <button onclick="openConfig()" class="bg-amber-600 px-3 py-1.5 rounded-xl text-[9px] font-black uppercase">Config</button>
                <button onclick="logout()" class="bg-rose-600 px-3 py-1.5 rounded-xl text-[9px] font-black uppercase">Logout</button>
            </div>
        </nav>

        <div class="container mx-auto p-2 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-4 no-print">
                <div class="bg-white p-6 rounded-[2.5rem] shadow-xl border-t-[12px] border-slate-900">
                    <form id="ledgerForm" class="space-y-4">
                        <div class="grid grid-cols-2 gap-2">
                            <input type="date" id="tDate" required class="w-full border-2 p-3 rounded-xl font-bold text-xs input-focus">
                            <select id="tMode" required class="w-full border-2 p-3 rounded-xl font-bold text-xs bg-slate-50 input-focus">
                                <option value="Cash">Cash</option><option value="EasyPaisa">EasyPaisa</option>
                                <option value="JazzCash">JazzCash</option><option value="Udhaar">Udhaar</option>
                                <option value="Bank">Bank Transfer</option>
                            </select>
                        </div>
                        <input list="partyList" id="tParty" placeholder="Name (Patient / Party)" required class="w-full border-2 p-3 rounded-xl font-bold text-sm input-focus">
                        <select id="tCat" onchange="toggleVisit(this.value)" required class="w-full border-2 p-3 rounded-xl font-bold text-sm bg-slate-50 input-focus"></select>
                        
                        <div id="visitBox" class="bg-indigo-50 p-4 rounded-2xl hidden-module space-y-3 border-2 border-indigo-100">
                            <p class="text-[9px] font-black text-indigo-400 uppercase">Extra Details / Medical Info</p>
                            <input type="text" id="vPurpose" placeholder="Purpose / Diagnosis" class="w-full border p-2 rounded-lg text-xs input-focus">
                            <div class="grid grid-cols-2 gap-2">
                                <select id="vMode" class="w-full border p-2 rounded-lg text-xs"><option value="Clinic">Clinic</option><option value="Home Visit">Home Visit</option></select>
                                <input type="number" id="vMisc" placeholder="Medicine Cost" class="w-full border p-2 rounded-lg text-xs input-focus">
                            </div>
                        </div>

                        <textarea id="tDesc" placeholder="Description..." class="w-full border-2 p-3 rounded-xl font-bold text-sm h-16 input-focus"></textarea>
                        
                        <div class="bg-slate-900 p-4 rounded-[2rem] text-center shadow-2xl">
                            <input type="number" id="tAmount" placeholder="0.00" required class="w-full bg-transparent text-white font-black text-4xl text-center outline-none">
                        </div>
                        
                        <button type="submit" class="w-full bg-indigo-600 text-white py-4 rounded-2xl font-black uppercase shadow-xl hover:bg-indigo-800 transition-all">Save Entry [Alt+S]</button>
                    </form>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-4">
                <div class="flex flex-wrap gap-2 no-print">
                    <input type="text" id="mSearch" oninput="render()" placeholder="üîç Quick Search..." class="flex-1 border-2 p-3 rounded-2xl font-black text-xs uppercase input-focus">
                    <button onclick="exportToExcel()" class="bg-emerald-600 text-white px-4 py-3 rounded-2xl font-black text-[10px] uppercase shadow-md">Excel [Alt+X]</button>
                    <button onclick="window.print()" class="bg-slate-800 text-white px-4 py-3 rounded-2xl font-black text-[10px] uppercase shadow-md">Print [Alt+P]</button>
                </div>

                <div id="dash" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>

                <div class="bg-white rounded-[2.5rem] shadow-2xl overflow-hidden border-2 border-slate-100">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-[11px] md:text-sm">
                            <thead class="bg-slate-900 text-white font-black uppercase italic">
                                <tr><th class="p-4">Date</th><th class="p-4">Details</th><th class="p-4 text-center">Type</th><th class="p-4 text-right">Amount</th><th class="p-4 text-center no-print">Act</th></tr>
                            </thead>
                            <tbody id="tBody" class="font-bold divide-y italic"></tbody>
                        </table>
                    </div>
                </div>
                <div class="no-print pt-6 text-center">
                    <button onclick="sendSupportEmail()" class="text-[10px] font-black text-slate-400 hover:text-indigo-500 uppercase italic">Developed by Ikraam Uppal | Support</button>
                </div>
            </div>
        </div>
    </div>

    <div id="configModal" class="fixed inset-0 bg-white z-[200] hidden flex flex-col no-print">
        <div class="bg-slate-900 p-4 text-white flex justify-between items-center shadow-lg">
            <h2 class="font-black uppercase text-xs italic">System Configuration</h2>
            <button onclick="closeConfig()" class="bg-rose-600 px-6 py-2 rounded-xl text-[10px] font-black uppercase">Close</button>
        </div>
        <div class="p-6 overflow-y-auto flex-1 bg-slate-50 space-y-6">
            <div class="bg-white p-6 rounded-3xl shadow-sm border">
                <h3 class="font-black text-xs uppercase text-indigo-600 mb-4">üé® Appearance & Formatting</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] font-black uppercase text-slate-400">Select Theme</label>
                        <select id="cfgTheme" class="w-full border-b-2 p-2 font-bold outline-none">
                            <option value="classic">Professional Blue</option>
                            <option value="emerald">Emerald Green</option>
                            <option value="dark">Midnight Dark</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-black uppercase text-slate-400">Date Format</label>
                        <select id="cfgDateFormat" class="w-full border-b-2 p-2 font-bold outline-none">
                            <option value="YYYY-MM-DD">Year-Month-Day</option>
                            <option value="DD/MM/YYYY">Day/Month/Year</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-3xl shadow-sm border">
                <h3 class="font-black text-xs uppercase text-indigo-600 mb-4">‚öôÔ∏è Category & Feature Control</h3>
                <div id="configGrid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>
        </div>
        <div class="p-6 bg-white border-t">
            <button onclick="saveConfig()" class="w-full bg-indigo-600 text-white py-5 rounded-[2rem] font-black uppercase shadow-2xl transition-all">Apply My Custom Settings</button>
        </div>
    </div>

    <div id="guideModal" class="fixed inset-0 bg-white z-[400] hidden flex flex-col p-8 overflow-y-auto">
        <div class="max-w-2xl mx-auto w-full">
            <h2 class="font-black text-3xl italic mb-4 border-b-4 border-indigo-600 inline-block">Advance Ledger Guide</h2>
            
            <div class="space-y-6">
                <div class="bg-blue-50 p-5 rounded-[2rem] border-l-8 border-blue-600">
                    <h4 class="font-black uppercase text-blue-700 text-sm mb-1">üè• For Doctors (Homeo/Allo)</h4>
                    <p class="text-[11px] text-slate-600 leading-relaxed italic">
                        1. <b>Config</b> mein jayein aur INC-01 ko <b>"Patient Fees"</b> rename karein.<br>
                        2. OFFICE-BILL ko <b>"Consultation/Procedure"</b> rename karein.<br>
                        3. Entry karte waqt "Medicine Cost" bhi add kar sakte hain. Dashboard aapko total clinic income dikhayega.
                    </p>
                </div>

                <div class="bg-emerald-50 p-5 rounded-[2rem] border-l-8 border-emerald-600">
                    <h4 class="font-black uppercase text-emerald-700 text-sm mb-1">üõç For Shopkeepers</h4>
                    <p class="text-[11px] text-slate-600 leading-relaxed italic">
                        1. INC-01 ko <b>"Daily Counter Sale"</b> rakhein.<br>
                        2. EXP-04 ko <b>"Stock Purchase"</b> rename karein.<br>
                        3. Udhaar category se apne dendaar (customers) ka record alag se track karein.
                    </p>
                </div>

                <div class="bg-rose-50 p-5 rounded-[2rem] border-l-8 border-rose-600">
                    <h4 class="font-black uppercase text-rose-700 text-sm mb-1">üí∞ Borrowing/Loan (Qarza) Use</h4>
                    <p class="text-[11px] text-slate-600 leading-relaxed italic">
                        Agar business ke liye qarza liya hai, toh <b>"Borrowing Taken"</b> use karein. Wapsi karte waqt usay same category mein minus (-) entry ya alag wapsi category mein dalein. Balance dashboard par "Loan Bal" mein dikhega.
                    </p>
                </div>

                <div class="bg-slate-900 text-white p-5 rounded-[2rem]">
                    <h4 class="font-black uppercase text-indigo-400 text-sm mb-1">üõ° Feature On/Off Logic</h4>
                    <p class="text-[11px] leading-relaxed italic">
                        Agar aapko koi feature (maslan Visit Pro) nahi chahiye, toh Config mein uska <b>Tick hata dain</b>. Aapka purana data backend par rahega, bas samne se gayab ho jayega. Dobara tick lagane par data wapas mil jayega.
                    </p>
                </div>
            </div>
            <button onclick="closeGuide()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black uppercase mt-10 shadow-xl">Theek Hai, Start Karte Hain!</button>
        </div>
    </div>

    <datalist id="partyList"></datalist>

    <script>
        // --- FIREBASE CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyDzSEb2I1VXKQtrRj6XwzCB4lwC7T4X1go",
            authDomain: "ikraamledger.firebaseapp.com",
            databaseURL: "https://ikraamledger-default-rtdb.firebaseio.com",
            projectId: "ikraamledger",
            storageBucket: "ikraamledger.firebasestorage.app",
            messagingSenderId: "992347779396",
            appId: "1:992347779396:web:8251534d4358587bf5a711"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const rdb = firebase.database();
        
        let currentUser = null;
        const CODES = ["INC-01", "EXP-01", "OFFICE-BILL", "INC-08", "INC-05", "EXP-03", "INC-04", "EXP-04"];
        let db = { 
            entries: [], parties: [], 
            labels: {"INC-01":"Income Sale","EXP-01":"Misc Expense","OFFICE-BILL":"Visit/Clinic Pro","INC-08":"Visit Recovery","INC-05":"Borrowing (Loan Taken)","EXP-03":"Loan Given","INC-04":"Udhaar Recv.","EXP-04":"Udhaar Diya"},
            visible: CODES.reduce((a,c)=>({...a,[c]:true}), {}),
            theme: 'classic',
            dateFormat: 'YYYY-MM-DD'
        };

        // --- THEME ENGINE ---
        function applyTheme(t) {
            const root = document.documentElement;
            if(t === 'emerald') { root.style.setProperty('--primary', '#10b981'); root.style.setProperty('--main-bg', '#ecfdf5'); }
            else if(t === 'dark') { root.style.setProperty('--primary', '#818cf8'); root.style.setProperty('--main-bg', '#0f172a'); document.body.classList.add('dark-mode-text'); }
            else { root.style.setProperty('--primary', '#4f46e5'); root.style.setProperty('--main-bg', '#f8fafc'); }
        }

        // --- KEYBOARD ENGINE ---
        window.addEventListener('keydown', e => {
            if(e.altKey && e.key === 's') { e.preventDefault(); document.querySelector('button[type="submit"]').click(); }
            if(e.altKey && e.key === 'x') { e.preventDefault(); exportToExcel(); }
            if(e.altKey && e.key === 'p') { e.preventDefault(); window.print(); }
        });

        // --- AUTH & DATA ENGINE ---
        function handleAuth(type) {
            const email = document.getElementById('userEmail').value;
            const pass = document.getElementById('userPass').value;
            if(!email) { alert("Email please!"); return; }
            showLoader(true);
            if(type === 'reset') { auth.sendPasswordResetEmail(email).then(()=>alert("Reset link sent!")).finally(()=>showLoader(false)); }
            else if(type === 'signup') { auth.createUserWithEmailAndPassword(email, pass).catch(e=>alert(e.message)).finally(()=>showLoader(false)); }
            else { auth.signInWithEmailAndPassword(email, pass).catch(e=>alert("Login Error")).finally(()=>showLoader(false)); }
        }

        auth.onAuthStateChanged(user => {
            if(user) { currentUser = user; document.getElementById('authSection').classList.add('hidden'); document.getElementById('mainApp').classList.remove('hidden'); loadUserData(); }
            else { document.getElementById('authSection').classList.remove('hidden'); document.getElementById('mainApp').classList.add('hidden'); }
        });

        function loadUserData() {
            rdb.ref('users/' + currentUser.uid).on('value', snap => {
                if(snap.exists()) { 
                    db = {...db, ...snap.val()}; 
                    applyTheme(db.theme);
                    render(); 
                } else { save(); }
            });
        }

        function save() { if(currentUser) rdb.ref('users/' + currentUser.uid).set(db); }

        function logout() { if(confirm("Logout?")) auth.signOut(); }

        function render() {
            const catS = document.getElementById('tCat'); catS.innerHTML = '<option value="">Select Category</option>';
            CODES.forEach(c => { if(db.visible[c]) catS.appendChild(new Option(db.labels[c], c)); });
            
            const tbody = document.getElementById('tBody'); tbody.innerHTML = '';
            const q = document.getElementById('mSearch').value.toLowerCase();
            let s = { cash: 0, rec: 0, off: 0, loan: 0 };

            (db.entries || []).forEach(t => {
                const searchStr = `${t.party} ${t.desc} ${t.mode} ${db.labels[t.cat]}`.toLowerCase();
                if(!q || searchStr.includes(q)) {
                    const isInc = t.cat.startsWith('INC');
                    const amt = parseFloat(t.amount);
                    
                    // Calculation logic (Backend logic stays even if feature is hidden)
                    if(t.mode !== 'Udhaar') s.cash += (isInc ? amt : -amt);
                    if(t.cat === 'EXP-04') s.rec += amt; if(t.cat === 'INC-04') s.rec -= amt;
                    if(t.cat === 'OFFICE-BILL') s.off += amt; if(t.cat === 'INC-08') s.off -= amt;
                    if(t.cat === 'INC-05') s.loan += amt; if(t.cat === 'EXP-03') s.loan -= amt;

                    // Row rendering with Date Format Logic
                    let displayDate = t.date;
                    if(db.dateFormat === 'DD/MM/YYYY') {
                        const [y, m, d] = t.date.split('-');
                        displayDate = `${d}/${m}/${y}`;
                    }

                    tbody.innerHTML += `<tr class="border-b border-slate-100 hover:bg-slate-50 transition-colors">
                        <td class="p-4 text-slate-400 font-normal">#${t.id.toString().slice(-4)}<br>${displayDate}</td>
                        <td class="p-4 uppercase"><b>${t.party}</b><br><small class="text-slate-500 font-normal leading-tight">${t.desc}</small></td>
                        <td class="p-4 text-center">
                            <span class="text-[8px] font-black uppercase bg-indigo-50 text-indigo-600 p-1 rounded-lg">${db.labels[t.cat]}</span>
                            <br><small class="text-slate-400 font-bold uppercase text-[9px]">${t.mode}</small>
                        </td>
                        <td class="p-4 text-right font-black text-lg ${isInc?'text-emerald-600':'text-rose-600'} amount-val">${amt.toLocaleString()}</td>
                        <td class="p-4 text-center no-print"><button onclick="deleteEntry(${t.id})" class="text-rose-500">üóë</button></td>
                    </tr>`;
                }
            });
            updateDash(s);
            updatePartyList();
        }

        function updateDash(s) {
            // Dashboard values update based on all data (even if category is hidden, balance must be accurate)
            document.getElementById('dash').innerHTML = `
                <div class="bg-white p-4 rounded-3xl border-b-8 border-slate-900 shadow-lg text-center"><p class="text-[8px] font-black text-slate-400 uppercase">Cash Bal</p><h2 class="font-black text-xl amount-val">${s.cash.toLocaleString()}</h2></div>
                <div class="bg-white p-4 rounded-3xl border-b-8 border-emerald-500 shadow-lg text-center"><p class="text-[8px] font-black text-emerald-500 uppercase">Receivable</p><h2 class="font-black text-xl text-emerald-700 amount-val">${s.rec.toLocaleString()}</h2></div>
                <div class="bg-white p-4 rounded-3xl border-b-8 border-amber-500 shadow-lg text-center"><p class="text-[8px] font-black text-amber-500 uppercase">Visit/Clinic</p><h2 class="font-black text-xl text-amber-700 amount-val">${s.off.toLocaleString()}</h2></div>
                <div class="bg-white p-4 rounded-3xl border-b-8 border-rose-500 shadow-lg text-center"><p class="text-[8px] font-black text-rose-500 uppercase">Loan Bal</p><h2 class="font-black text-xl text-rose-700 amount-val">${s.loan.toLocaleString()}</h2></div>`;
        }

        function exportToExcel() {
            showLoader(true);
            setTimeout(() => {
                const data = (db.entries || []).map(t => ({
                    Date: t.date, Party: t.party.toUpperCase(),
                    Category: db.labels[t.cat], Mode: t.mode,
                    Amount: t.amount, Description: t.desc
                }));
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Ledger");
                XLSX.writeFile(wb, `Report_${new Date().toLocaleDateString()}.xlsx`);
                showLoader(false);
            }, 600);
        }

        function showLoader(s) { document.getElementById('loader').classList.toggle('hidden', !s); }
        function showGuide() { document.getElementById('guideModal').classList.remove('hidden'); }
        function closeGuide() { document.getElementById('guideModal').classList.add('hidden'); }
        function toggleVisit(v) { document.getElementById('visitBox').classList.toggle('hidden-module', v !== 'OFFICE-BILL'); }
        function deleteEntry(id) { if(confirm("Delete record?")) { db.entries = db.entries.filter(x=>x.id!==id); save(); } }
        function updatePartyList() { const pL = document.getElementById('partyList'); pL.innerHTML = ''; (db.parties || []).forEach(p => pL.innerHTML += `<option value="${p}">`); }

        document.getElementById('ledgerForm').onsubmit = (e) => {
            e.preventDefault();
            let amt = parseFloat(document.getElementById('tAmount').value);
            let desc = document.getElementById('tDesc').value;
            const cat = document.getElementById('tCat').value;
            if(cat === 'OFFICE-BILL') {
                const m = parseFloat(document.getElementById('vMisc').value) || 0;
                amt += m; desc = `[Med/Visit Cost: ${m}] ` + desc;
            }
            db.entries.unshift({ id: Date.now(), date: document.getElementById('tDate').value, party: document.getElementById('tParty').value, cat: cat, mode: document.getElementById('tMode').value, desc: desc, amount: amt });
            if(!db.parties.includes(document.getElementById('tParty').value)) db.parties.push(document.getElementById('tParty').value);
            save(); e.target.reset(); document.getElementById('tDate').focus();
        };

        function openConfig() {
            const g = document.getElementById('configGrid'); g.innerHTML = '';
            document.getElementById('cfgTheme').value = db.theme || 'classic';
            document.getElementById('cfgDateFormat').value = db.dateFormat || 'YYYY-MM-DD';
            
            CODES.forEach(c => {
                g.innerHTML += `<div class="bg-white p-5 rounded-3xl shadow-sm border-2 border-slate-100 flex items-center gap-4">
                    <input type="checkbox" id="vis_${c}" ${db.visible[c]?'checked':''} class="w-6 h-6 rounded-lg text-indigo-600">
                    <div class="flex-1">
                        <label class="text-[9px] font-black text-slate-400 uppercase block mb-1">Code: ${c}</label>
                        <input type="text" id="lbl_${c}" value="${db.labels[c]}" class="w-full border-b-2 border-slate-100 font-bold outline-none uppercase text-xs focus:border-indigo-600 transition-all">
                    </div>
                </div>`;
            });
            document.getElementById('configModal').classList.remove('hidden');
        }
        function closeConfig() { document.getElementById('configModal').classList.add('hidden'); }
        function saveConfig() {
            CODES.forEach(c => { db.visible[c] = document.getElementById(`vis_${c}`).checked; db.labels[c] = document.getElementById(`lbl_${c}`).value; });
            db.theme = document.getElementById('cfgTheme').value;
            db.dateFormat = document.getElementById('cfgDateFormat').value;
            save(); closeConfig();
        }
        function sendSupportEmail() { window.location.href = `mailto:uppalcomputers@gmail.com?subject=Ledger Support Request`; }
    </script>
</body>
</html>